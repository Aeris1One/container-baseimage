#!/bin/bash -e

nbDirectories=$(find /etc/service -mindepth 1 -maxdepth 1 -type d | wc -l )

# Multiple process image
if [ "$nbDirectories" -gt 1 ]; then
  echo "Execute /sbin/my_init"
  exec /sbin/my_init

# Single process image
elif [ "$nbDirectories" -eq 1 ]; then

  SERVICE=$(find /etc/service -mindepth 1 -maxdepth 1 -type d)

  echo "Execute /sbin/my_init --single-process"
  /sbin/my_init --single-process || true

  echo "Include /etc/container_environment.sh"
  source /etc/container_environment.sh

  echo "Execute $SERVICE/run"
  source $SERVICE/run

# No process set
else
  echo "Execute /sbin/my_init --skip-runit bash"
  exec /sbin/my_init --skip-runit bash
fi
