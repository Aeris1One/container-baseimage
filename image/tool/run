#!/bin/bash -e

nbDirectories=$(find /container/run/service -mindepth 1 -maxdepth 1 -type d | wc -l )

# Multiple process image
if [ "$nbDirectories" -gt 1 ]; then
  echo "Execute /container/tool/my_init"
  exec /container/tool/my_init

# Single process image
elif [ "$nbDirectories" -eq 1 ]; then

  SERVICE=$(find /container/run/service -mindepth 1 -maxdepth 1 -type d)

  echo "Execute /container/tool/my_init --skip-runit $SERVICE/run"
  exec /container/tool/my_init --skip-runit $SERVICE/run $@

# No process set
else
  echo "Execute /container/tool/my_init --skip-runit bash"
  exec /container/tool/my_init --skip-runit bash
fi
